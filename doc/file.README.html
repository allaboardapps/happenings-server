<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  File: README
  
    &mdash; Happenings Server Documentation
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "README";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="file_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: README</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><div id='filecontents'><h1>Happenings Server</h1>

<h2>Documentation</h2>

<ul>
<li>We use <a href="http://yardoc.org">YARD</a> for documentation</li>
<li>To update docs, run <code>yard doc</code></li>
<li>To view docs locally, run <code>yard server</code> and visit <a href="http://localhost:8808">http://localhost:8808</a></li>
</ul>


<h2>Annotations in the codebase</h2>

<ul>
<li>Ref: <a href="http://guides.rubyonrails.org/command_line.html#notes">http://guides.rubyonrails.org/command_line.html#notes</a></li>
<li>View annotations in the command line with <code>rails notes</code></li>
<li>Notes in <code>rb</code> files need to be written as <code># TODO: This is a task</code></li>
<li>Notes in <code>js</code> files need to be written as <code>// TODO This is a task %&gt;</code></li>
<li>Notes in <code>scss, css</code> files need to be written as <code>// TODO This is a task</code></li>
<li>Notes in <code>erb</code> files need to be written as <code>&lt;% TODO This is a task %&gt;</code></li>
<li>You must have <code>SOURCE_ANNOTATION_DIRECTORIES: "spec"</code> specified in your environment variables for spec file annotations to be captured.</li>
</ul>


<h2>Heroku Versions</h2>

<h3>Staging</h3>

<ul>
<li>ruby 2.4.1</li>
<li>rails 5.0.2</li>
<li>postgres 9.6.2</li>
<li>elasticsearch 5.1.2</li>
</ul>


<h3>Production</h3>

<ul>
<li>ruby 2.4.1</li>
<li>rails 5.0.2</li>
<li>postgres 9.6.2</li>
<li>elasticsearch 5.1.2</li>
</ul>


<h2>Installation</h2>

<p><code>rails new happenings-server --database=postgresql --skip-spring --skip-turbolinks --skip-test --skip-action-cable</code></p>

<h2>Heroku Setup</h2>

<ul>
<li>Deploys from Github master branch</li>
<li>Utilizes <a href="https://app.codeship.com/projects/213232">CodeShip for CI</a></li>
<li><code>git remote add staging https://git.heroku.com/happenings-server-staging.git</code></li>
<li><code>git remote add production https://git.heroku.com/happenings-server-production.git</code></li>
</ul>


<h2>Security Checks</h2>

<ul>
<li>run <code>bundle outdated</code> > update gems with <code>bundle update</code> > run tests</li>
<li>run <code>bundle-audit update</code></li>
<li>run <code>bundle-audit</code></li>
<li>run <code>brakeman</code></li>
<li>run <code>hakiri system:steps</code></li>
<li>run <code>hakiri manifest:generate</code> > <code>hakiri system:scan</code></li>
<li>run <code>hakiri gemfile:scan</code></li>
</ul>


<h2>Security References</h2>

<ul>
<li><a href="http://gavinmiller.io/2015/staying-up-to-date-with-security-alerts/">How Do Ruby/Rails Developers Keep Updated on Security Alerts?</a></li>
<li><a href="https://groups.google.com/forum/#!forum/ruby-security-ann">Ruby Security Mailing List</a></li>
<li><a href="https://groups.google.com/forum/?fromgroups#!forum/rubyonrails-security">Rails Security Mailing List</a></li>
<li><a href="https://www.cvedetails.com/">CVE Details</a></li>
<li><a href="https://hakiri.io/">Hakiri service (fee-based)</a></li>
<li><a href="https://appcanary.com/">AppCanary service (fee-based)</a></li>
</ul>


<h3>Setup Heroku</h3>

<p>First, you'll need to ask to be added as a collaborator to the Heroku projects for access.</p>

<p>Second, you'll need to connect your local git repo to the heroku repos:
* connect to staging: <code>git remote add staging https://git.heroku.com/happenings-server-staging.git</code>
* connect to production: <code>git remote add production https://git.heroku.com/happenings-server-production.git</code>
* review your remotes: <code>git remote -v</code></p>

<p>You should see something like this:
<code>
origin  https://github.com/allaboardapps/happenings-server-server.git (fetch)
origin  https://github.com/allaboardapps/happenings-server-server.git (push)
production  https://git.heroku.com/happenings-server-production.git (fetch)
production  https://git.heroku.com/happenings-server-production.git (push)
staging https://git.heroku.com/happenings-server-staging.git (fetch)
staging https://git.heroku.com/happenings-server-staging.git (push)
</code></p>

<h3>Setup RVM</h3>

<ul>
<li>Ref: <a href="https://gist.github.com/wrburgess/a6fc079cee6f14fc601b1">https://gist.github.com/wrburgess/a6fc079cee6f14fc601b1</a></li>
<li>Install with curl: <code>\curl -sSL https://get.rvm.io | bash -s stable</code></li>
<li>Source RVM: <code>source /Users/[user]/.rvm/scripts/rvm</code></li>
<li>As a routine process, you may want to update with: <code>rvm get stable</code></li>
</ul>


<h3>Setup Ruby</h3>

<ul>
<li>Ref: <a href="https://gist.github.com/wrburgess/a6fc079cee6f14fc601b">https://gist.github.com/wrburgess/a6fc079cee6f14fc601b</a></li>
<li>Update ruby: <code>rvm get stable --ruby</code></li>
<li>Confirm ruby version changed: <code>ruby -v</code></li>
<li>Create <code>.ruby-version</code> file in root dir with ruby version number, ex: <code>2.4.1</code></li>
</ul>


<h3>Setup Rails</h3>

<ul>
<li>Note: This app utilizes <code>uuid</code> data types for all model/table ids.</li>
<li>Ref: (Rails 5 UUIDs) <a href="https://gist.github.com/wrburgess/c1678788181d5f5577c6e84ac5a3efab">https://gist.github.com/wrburgess/c1678788181d5f5577c6e84ac5a3efab</a></li>
</ul>


<h3>Setup Environment Variables</h3>

<ul>
<li>Ref: <a href="https://github.com/laserlemon/figaro">https://github.com/laserlemon/figaro</a></li>
<li>Note: We use the figaro gem to store and access env variables out of the reach of source control</li>
<li>Note: You will need to retrieve the valid variables from a team member and place the contents in the <code>/config/application.yml</code> file.</li>
</ul>


<h3>Setup Foreman</h3>

<ul>
<li>Ref: <a href="https://github.com/ddollar/foreman">https://github.com/ddollar/foreman</a></li>
<li>Install: <code>gem install foreman</code></li>
<li>Note: This will run the <code>Procfile</code> and <code>Procfile.development</code> instructions</li>
<li>Note: You can run your processes with <code>foreman start -f Procfile.development</code></li>
<li>Note: Heroku will utilize the <code>Procfile</code> instructions</li>
</ul>


<h3>Run Servers</h3>

<ul>
<li>to run the local server type <code>rails server</code> or <code>rails s</code></li>
<li>visit <code>localhost:3000</code></li>
</ul>


<h3>Understanding Pundit for Authorization</h3>

<ul>
<li>We use the <code>pundit</code> gem for authorization in controllers</li>
<li>Ref: <a href="https://github.com/elabs/pundit">https://github.com/elabs/pundit</a></li>
<li>Ref: <a href="https://github.com/chrisalley/pundit-matchers">https://github.com/chrisalley/pundit-matchers</a></li>
<li>Policies are located in <code>app/policies</code></li>
<li>Specs for policies are located in <code>spec/policies</code></li>
</ul>


<h3>robots.txt</h3>

<ul>
<li>Ref: <a href="http://www.jakobbeyer.de/creating-a-dynamic-robots-txt-for-ruby-on-rails">http://www.jakobbeyer.de/creating-a-dynamic-robots-txt-for-ruby-on-rails</a></li>
<li>Note: Changes to the <code>robots.txt</code> file can be adjusted in the <code>/app/views/static/robots.text.erb</code> file</li>
</ul>


<h3>Deployment</h3>

<ol>
<li>Push your branch to GitHub with <code>git push origin [branch-name]</code></li>
<li>HerokuCI will build the app, run <code>rspec</code>, and scan style with <code>rubocop</code>.</li>
<li>When the <code>master</code> branch passes on the HerokuCI build, the app will be deployed to the staging server on Heroku</li>
<li>The application is hosted on a Heroku Pipeline named <a href="https://dashboard.heroku.com/pipelines/2f569902-f8e9-4f7c-8828-b06c488c2b66">happenings-server</a></li>
<li>You can promote the staging app to production (<code>happenings-server-staging</code> to <code>happenings-server-production</code>) via <code>heroku pipelines:promote -r staging</code></li>
<li>Post-deploy tasks are referenced in the <code>Procfile</code> after the <code>release:</code> instruction</li>
<li>The deploy tasks are located in the <code>/lib/tasks/app.rake</code> file</li>
<li>To create a new version tag the last commit with <code>git tag -d v[semver]</code> and <code>git push --tags origin</code></li>
</ol>


<h2>Quality Control</h2>

<ul>
<li>run Rails tests: <code>bundle exec rspec spec</code></li>
<li>run Rubocop linting: <code>rubocop</code></li>
</ul>


<h3>Email Systems</h3>

<h4>Development</h4>

<p>We are using <a href="https://github.com/fgrehm/letter_opener_web">Letter Opener Web</a> which will ease the development of emails. Instead of actually sending the emails, they will be caught and stored at <code>/tmp/letter_opener</code>. This way they can be viewed and evaluated. You can view and delete the emails at <code>http://localhost:3000/letter_opener/</code></p>

<h4>Staging</h4>

<p>Using Mailtrap</p>

<h4>Production</h4>

<p>Using Postmark</p>
</div></div>

      <div id="footer">
  Generated on Sun Apr 16 12:48:13 2017 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.8 (ruby-2.4.1).
</div>

    </div>
  </body>
</html>