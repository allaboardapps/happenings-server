<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  File: README
  
    &mdash; Happenings Server Documentation
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "README";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: README</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><div id='filecontents'>
<h1 id="label-Happenings+Server">Happenings Server</h1>

<h2 id="label-Documentation">Documentation</h2>
<ul><li>
<p>We use <a href="http://yardoc.org">YARD</a> for documentation</p>
</li><li>
<p>To update docs, run <code>yard doc</code></p>
</li><li>
<p>To view docs locally, run <code>yard server</code> and visit <a
href="http://localhost:8808">localhost:8808</a></p>
</li></ul>

<h2 id="label-Annotations+in+the+codebase">Annotations in the codebase</h2>
<ul><li>
<p>Ref: <a
href="http://guides.rubyonrails.org/command_line.html#notes">guides.rubyonrails.org/command_line.html#notes</a></p>
</li><li>
<p>View annotations in the command line with <code>rails notes</code></p>
</li><li>
<p>Notes in <code>rb</code> files need to be written as <code># TODO: This is
a task</code></p>
</li><li>
<p>Notes in <code>js</code> files need to be written as <code>// TODO This is
a task %&gt;</code></p>
</li><li>
<p>Notes in <code>scss, css</code> files need to be written as <code>// TODO
This is a task</code></p>
</li><li>
<p>Notes in <code>erb</code> files need to be written as <code>&lt;% TODO This
is a task %&gt;</code></p>
</li><li>
<p>You must have <code>SOURCE_ANNOTATION_DIRECTORIES: &quot;spec&quot;</code>
specified in your environment variables for spec file annotations to be
captured.</p>
</li></ul>

<h2 id="label-Heroku+Versions">Heroku Versions</h2>

<h3 id="label-Staging">Staging</h3>
<ul><li>
<p>ruby 2.4.1</p>
</li><li>
<p>rails 5.0.2</p>
</li><li>
<p>postgres 9.6.2</p>
</li><li>
<p>elasticsearch 5.1.2</p>
</li></ul>

<h3 id="label-Production">Production</h3>
<ul><li>
<p>ruby 2.4.1</p>
</li><li>
<p>rails 5.0.2</p>
</li><li>
<p>postgres 9.6.2</p>
</li><li>
<p>elasticsearch 5.1.2</p>
</li></ul>

<h2 id="label-Installation">Installation</h2>

<p><code>rails new happenings-server --database=postgresql --skip-spring
--skip-turbolinks --skip-test --skip-action-cable</code></p>

<h2 id="label-Heroku+Setup">Heroku Setup</h2>
<ul><li>
<p>Deploys from Github master branch</p>
</li><li>
<p>Utilizes <a href="https://app.codeship.com/projects/213232">CodeShip for
CI</a></p>
</li><li>
<p><code>git remote add staging
https://git.heroku.com/happenings-server-staging.git</code></p>
</li><li>
<p><code>git remote add production
https://git.heroku.com/happenings-server-production.git</code></p>
</li></ul>

<h2 id="label-Security+Checks">Security Checks</h2>
<ul><li>
<p>run <code>bundle outdated</code> &gt; update gems with <code>bundle
update</code> &gt; run tests</p>
</li><li>
<p>run <code>bundle-audit update</code></p>
</li><li>
<p>run <code>bundle-audit</code></p>
</li><li>
<p>run <code>brakeman</code></p>
</li><li>
<p>run <code>hakiri system:steps</code></p>
</li><li>
<p>run <code>hakiri manifest:generate</code> &gt; <code>hakiri
system:scan</code></p>
</li><li>
<p>run <code>hakiri gemfile:scan</code></p>
</li></ul>

<h2 id="label-Security+References">Security References</h2>
<ul><li>
<p><a
href="http://gavinmiller.io/2015/staying-up-to-date-with-security-alerts/">How
Do Ruby/Rails Developers Keep Updated on Security Alerts?</a></p>
</li><li>
<p><a href="https://groups.google.com/forum/#!forum/ruby-security-ann">Ruby
Security Mailing List</a></p>
</li><li>
<p><a
href="https://groups.google.com/forum/?fromgroups#!forum/rubyonrails-security">Rails
Security Mailing List</a></p>
</li><li>
<p><a href="https://www.cvedetails.com/">CVE Details</a></p>
</li><li>
<p><a href="https://hakiri.io/">Hakiri service (fee-based)</a></p>
</li><li>
<p><a href="https://appcanary.com/">AppCanary service (fee-based)</a></p>
</li></ul>

<h3 id="label-Setup+Heroku">Setup Heroku</h3>

<p>First, you&#39;ll need to ask to be added as a collaborator to the Heroku
projects for access.</p>

<p>Second, you&#39;ll need to connect your local git repo to the heroku repos:
* connect to staging: <code>git remote add staging
https://git.heroku.com/happenings-server-staging.git</code> * connect to
production: <code>git remote add production
https://git.heroku.com/happenings-server-production.git</code> * review
your remotes: <code>git remote -v</code></p>

<p>You should see something like this: <code> origin 
https://github.com/allaboardapps/happenings-server-server.git (fetch)
origin  https://github.com/allaboardapps/happenings-server-server.git
(push) production  https://git.heroku.com/happenings-server-production.git
(fetch) production  https://git.heroku.com/happenings-server-production.git
(push) staging https://git.heroku.com/happenings-server-staging.git (fetch)
staging https://git.heroku.com/happenings-server-staging.git (push) </code></p>

<h3 id="label-Setup+RVM">Setup RVM</h3>
<ul><li>
<p>Ref: <a
href="https://gist.github.com/wrburgess/a6fc079cee6f14fc601b1">gist.github.com/wrburgess/a6fc079cee6f14fc601b1</a></p>
</li><li>
<p>Install with curl: <code>\curl -sSL https://get.rvm.io | bash -s
stable</code></p>
</li><li>
<p>Source RVM: <code>source /Users/[user]/.rvm/scripts/rvm</code></p>
</li><li>
<p>As a routine process, you may want to update with: <code>rvm get
stable</code></p>
</li></ul>

<h3 id="label-Setup+Ruby">Setup Ruby</h3>
<ul><li>
<p>Ref: <a
href="https://gist.github.com/wrburgess/a6fc079cee6f14fc601b">gist.github.com/wrburgess/a6fc079cee6f14fc601b</a></p>
</li><li>
<p>Update ruby: <code>rvm get stable --ruby</code></p>
</li><li>
<p>Confirm ruby version changed: <code>ruby -v</code></p>
</li><li>
<p>Create <code>.ruby-version</code> file in root dir with ruby version
number, ex: <code>2.4.1</code></p>
</li></ul>

<h3 id="label-Setup+Rails">Setup Rails</h3>
<ul><li>
<p>Note: This app utilizes <code>uuid</code> data types for all model/table
ids.</p>
</li><li>
<p>Ref: (Rails 5 UUIDs) <a
href="https://gist.github.com/wrburgess/c1678788181d5f5577c6e84ac5a3efab">gist.github.com/wrburgess/c1678788181d5f5577c6e84ac5a3efab</a></p>
</li></ul>

<h3 id="label-Setup+Environment+Variables">Setup Environment Variables</h3>
<ul><li>
<p>Ref: <a
href="https://github.com/laserlemon/figaro">github.com/laserlemon/figaro</a></p>
</li><li>
<p>Note: We use the figaro gem to store and access env variables out of the
reach of source control</p>
</li><li>
<p>Note: You will need to retrieve the valid variables from a team member and
place the contents in the <code>/config/application.yml</code> file.</p>
</li></ul>

<h3 id="label-Setup+Foreman">Setup Foreman</h3>
<ul><li>
<p>Ref: <a
href="https://github.com/ddollar/foreman">github.com/ddollar/foreman</a></p>
</li><li>
<p>Install: <code>gem install foreman</code></p>
</li><li>
<p>Note: This will run the <code>Procfile</code> and
<code>Procfile.development</code> instructions</p>
</li><li>
<p>Note: You can run your processes with <code>foreman start -f
Procfile.development</code></p>
</li><li>
<p>Note: Heroku will utilize the <code>Procfile</code> instructions</p>
</li></ul>

<h3 id="label-Run+Servers">Run Servers</h3>
<ul><li>
<p>to run the local server type <code>rails server</code> or <code>rails
s</code></p>
</li><li>
<p>visit <code>localhost:3000</code></p>
</li></ul>

<h3 id="label-Understanding+Pundit+for+Authorization">Understanding Pundit for Authorization</h3>
<ul><li>
<p>We use the <code>pundit</code> gem for authorization in controllers</p>
</li><li>
<p>Ref: <a href="https://github.com/elabs/pundit">github.com/elabs/pundit</a></p>
</li><li>
<p>Ref: <a
href="https://github.com/chrisalley/pundit-matchers">github.com/chrisalley/pundit-matchers</a></p>
</li><li>
<p>Policies are located in <code>app/policies</code></p>
</li><li>
<p>Specs for policies are located in <code>spec/policies</code></p>
</li></ul>

<h3 id="label-robots.txt">robots.txt</h3>
<ul><li>
<p>Ref: <a
href="http://www.jakobbeyer.de/creating-a-dynamic-robots-txt-for-ruby-on-rails">www.jakobbeyer.de/creating-a-dynamic-robots-txt-for-ruby-on-rails</a></p>
</li><li>
<p>Note: Changes to the <code>robots.txt</code> file can be adjusted in the
<code>/app/views/static/robots.text.erb</code> file</p>
</li></ul>

<h3 id="label-Deployment">Deployment</h3>
<ol><li>
<p>Push your branch to GitHub with <code>git push origin [branch-name]</code></p>
</li><li>
<p>HerokuCI will build the app, run <code>rspec</code>, and scan style with
<code>rubocop</code>.</p>
</li><li>
<p>When the <code>master</code> branch passes on the HerokuCI build, the app
will be deployed to the staging server on Heroku</p>
</li><li>
<p>The application is hosted on a Heroku Pipeline named <a
href="https://dashboard.heroku.com/pipelines/2f569902-f8e9-4f7c-8828-b06c488c2b66">happenings-server</a></p>
</li><li>
<p>You can promote the staging app to production
(<code>happenings-server-staging</code> to
<code>happenings-server-production</code>) via <code>heroku
pipelines:promote -r staging</code></p>
</li><li>
<p>Post-deploy tasks are referenced in the <code>Procfile</code> after the
<code>release:</code> instruction</p>
</li><li>
<p>The deploy tasks are located in the <code>/lib/tasks/app.rake</code> file</p>
</li><li>
<p>To create a new version tag the last commit with <code>git tag -d
v[semver]</code> and <code>git push --tags origin</code></p>
</li></ol>

<h2 id="label-Quality+Control">Quality Control</h2>
<ul><li>
<p>run Rails tests: <code>bundle exec rspec spec</code></p>
</li><li>
<p>run Rubocop linting: <code>rubocop</code></p>
</li></ul>

<h3 id="label-Email+Systems">Email Systems</h3>

<h4 id="label-Development">Development</h4>

<p>We are using <a href="https://github.com/fgrehm/letter_opener_web">Letter
Opener Web</a> which will ease the development of emails. Instead of
actually sending the emails, they will be caught and stored at
<code>/tmp/letter_opener</code>. This way they can be viewed and evaluated.
You can view and delete the emails at
<code>http://localhost:3000/letter_opener/</code></p>

<h4 id="label-Staging">Staging</h4>

<p>Using Mailtrap</p>

<h4 id="label-Production">Production</h4>

<p>Using Postmark</p>
</div></div>

      <div id="footer">
  Generated on Tue Apr 18 20:58:48 2017 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.8 (ruby-2.4.1).
</div>

    </div>
  </body>
</html>